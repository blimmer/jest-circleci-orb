description: >
  Run jest tests, restoring jest's cache for speedier tests.

executor: << parameters.executor >>

parameters:
  executor:
    description: The executor to use
    type: executor
    default: default
  setup-steps:
    description: These steps are executed before all other steps. For example, you might log into a private NPM registry.
    type: steps
    default: []
  checkout:
    type: boolean
    default: true
    description: Boolean for whether or not to checkout as a first step. Default is true.
  pkg-manager:
    default: npm
    description: Select the default node package manager to use. NPM v5+ Required.
    enum:
      - npm
      - yarn
      - yarn-berry
    type: enum
  pkg-manager-override-install-command:
    default: ''
    description: >
      By default, packages will be installed with "npm ci", "yarn install
      --frozen-lockfile" or "yarn install --immutable".

      Optionally supply a custom package installation command, with any
      additional flags needed.
    type: string
  pkg-manager-cache:
    default: true
    description: Cache your node packages automatically for faster install times.
    type: boolean
  jest-cache:
    type: boolean
    default: true
    description: Boolean for whether or not to restore/save the jest cache.
  jest-cache-location:
    type: string
    default: .jest-cache
    description: The location of the jest cacheDirectory within the working directory
  jest-command:
    description: The command to use to run jest
    type: string
    default: npx --no-install jest
steps:
  - steps: << parameters.setup-steps >>
  - when:
      condition: << parameters.checkout >>
      steps:
        - checkout
  - node/install-packages:
      pkg-manager: << parameters.pkg-manager >>
      override-ci-command: << parameters.pkg-manager-override-install-command >>
      with-cache: << parameters.pkg-manager-cache >>
  - configure
  - when:
      condition: << parameters.jest-cache >>
      steps:
        - restore-cache:
            jest-cache-location: << parameters.jest-cache-location >>
  - run:
      name: Run jest tests
      command: << parameters.jest-command >>
  - when:
      condition: << parameters.jest-cache >>
      steps:
        - save-cache:
            jest-cache-location: << parameters.jest-cache-location >>
